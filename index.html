<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadastro com IMEI</title>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background: #f4f6f9;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
.container{
    background:#fff;
    padding:25px;
    border-radius:10px;
    width:400px;
    box-shadow:0 5px 15px rgba(0,0,0,0.1);
}
h2{
    text-align:center;
}
input{
    width:100%;
    padding:8px;
    margin:6px 0;
    border:1px solid #ccc;
    border-radius:5px;
}
button{
    width:100%;
    padding:10px;
    margin-top:10px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    font-weight:bold;
}
.btn-imei{
    background:#3498db;
    color:#fff;
}
.btn-enviar{
    background:#2ecc71;
    color:#fff;
}
button:hover{
    opacity:0.9;
}
</style>
</head>
<body>

<div class="container">
    <h2>Cadastro</h2>

    <input type="text" id="imei" placeholder="IMEI" readonly>
    <button class="btn-imei" onclick="getIMEI()">Obter IMEI</button>

    <input type="text" id="cep" placeholder="CEP" maxlength="8" onblur="buscarCEP()">
    <input type="text" id="rua" placeholder="Rua" readonly>
    <input type="text" id="numero" placeholder="Número">
    <input type="text" id="bairro" placeholder="Bairro" readonly>
    <input type="text" id="cidade" placeholder="Município" readonly>
    <input type="text" id="estado" placeholder="Estado" readonly>

    <input type="email" id="email" placeholder="Seu Email">

    <button class="btn-enviar" onclick="enviarDados()">Enviar</button>
</div>

<script>
// INICIALIZA EMAILJS
(function(){
    emailjs.init("YOUR_PUBLIC_KEY");
})();

// FUNÇÃO PARA OBTER IMEI (WebOTP - Android)
async function getIMEI(){
    try{
        if ('OTPCredential' in window) {
            const content = await navigator.credentials.get({
                otp: { transport:['sms'] },
                signal: new AbortController().signal
            });
            document.getElementById("imei").value = content.code;
        } else {
            alert("IMEI não pode ser capturado automaticamente neste dispositivo.");
        }
    }catch(error){
        alert("Não foi possível obter IMEI automaticamente.");
    }
}

// BUSCAR CEP VIA API
function buscarCEP(){
    let cep = document.getElementById("cep").value;

    if(cep.length !== 8){
        alert("CEP inválido");
        return;
    }

    fetch(`https://viacep.com.br/ws/${cep}/json/`)
    .then(response => response.json())
    .then(dados => {
        if(dados.erro){
            alert("CEP não encontrado");
            return;
        }

        document.getElementById("rua").value = dados.logradouro;
        document.getElementById("bairro").value = dados.bairro;
        document.getElementById("cidade").value = dados.localidade;
        document.getElementById("estado").value = dados.uf;
    });
}

// ENVIAR DADOS POR EMAIL
function enviarDados(){

    let params = {
        imei: document.getElementById("imei").value,
        cep: document.getElementById("cep").value,
        rua: document.getElementById("rua").value,
        numero: document.getElementById("numero").value,
        bairro: document.getElementById("bairro").value,
        cidade: document.getElementById("cidade").value,
        estado: document.getElementById("estado").value,
        email: document.getElementById("email").value
    };

    if(!params.imei || !params.cep || !params.numero || !params.email){
        alert("Preencha todos os campos obrigatórios!");
        return;
    }

    emailjs.send("YOUR_SERVICE_ID","YOUR_TEMPLATE_ID",params)
    .then(function(response){
        alert("Dados enviados com sucesso!");
    }, function(error){
        alert("Erro ao enviar.");
    });
}
</script>

</body>
</html>
